# Fallacies Of Distributed System: 分布式系统的误区

[toc]

> 分布式系统的误区是 ==[L Pete Deutsch](https://zh.m.wikipedia.org/zh-hans/%E5%BD%BC%E5%BE%97%C2%B7%E5%A4%9A%E4%BC%8A%E5%A5%87)== 和 ==[Sun Microsystems(大名鼎鼎的Sun 公司)](https://en.wikipedia.org/wiki/Sun_Microsystems)== 的其他人提出的一系列言论，描述了刚接触分布式应用程序的程序员总是会做出的错误假设。



当下时代微服务的大规模使用，触使了越来越多多的工程师去了解该解决方案在其系统中的影响和含义。我经常看到在讨论分析系统设计的时候有 `8` 个误区被普遍的忽略或淡忘。

![img](https://architecturenotes.co/content/images/2022/07/8-lessons-v2-01-1.jpg)

我认为把他们(八个分布式系统的误区)和他们潜在的缓解方案列举出来可能会很有趣。



## 什么是“微服务”

微服务也被称为微服务架构，是一种将应用程序构建为一系列服务集合的架构风格，它具有如下的特点：

- 高度可维护和可测试的
- 低耦合的
- 可独立部署的
- 围绕业务能力进行组织的
- 由一个小团队拥有的(可以理解为设计，开发，部署，维护等)

微服务架构支持快速，频繁，可靠的交付输出一个大型且复杂的应用程序。它也能使一个组织结构或者团队发展他的技术栈。



## 误区1：网络是可靠的

为了构架可靠系统，你必须清楚一个事实：无论多么特殊的通信都可能会失败；因此我们需要提供一种方法来解决这种潜在的通信丢失的风险。最终，我们可以把这种解决方式归结为 ==**重传**==，当然它可以有多种形式。

![img](https://architecturenotes.co/content/images/2022/06/8-lessons-v2-separate-04.jpg)

一种可行的方式是使用**存储转发模式**：使用存储转发模式代替直接将数据发送给下游服务器，我们可以把数据存储在本地或者其他地方。这种模式能够支持灾难情况下的灾难恢复，在这种情况下，简单的循环失败重试将缺乏此类保证。

有许多技术都符合这样的模式，例如 `RabbitMQ`, `ActiveMQ` 以及你喜欢的云服务厂商都提供了各种专用的解决方案。



## 误区二：网络延迟为0

如下图所示表示了访问现代系统(指代现代的存储器硬件，操作系统等组合形成的计算机系统)的内存所消耗的时间和在全世界进行网络访问耗时的时间对比：

<img src="https://architecturenotes.co/content/images/2022/06/8-lessons-v2-separate-05.jpg" alt="img" style="zoom:67%;" />

左图是现代系统访问内存的时间，右图是世界范围内进行网络访问所需的时间。

我喜欢将延迟视为完成任何请求的最小开销。消息数据可大可小，但是延迟是不会改变的。不像带宽，延迟通常和光速与通信距离(或者通信路径)有关，对我们而言，数据是通过光纤进行传播的，一般数据信息在光纤里面的速度近似为光速。因此两个系统之间的距离在这里扮演着一个重要的角色。

**延迟是无处不在的，它出现在任何通信系统中**

理想情况下，延迟开销应该尽可能的小。延迟非常类似于从汽车上卸载杂物，你从厨房到汽车的时间就是延迟。你是想在一次流程中尽可能多的携带杂物，还是想逐个逐个的携带，然后花费几百个流程来卸载车上的杂物。

**什么是 CDN**

> 内容分发网络 (CDN) 是指一组地理分布的服务器，它们协同工作以提供 Internet 内容的快速分发。CDN 允许快速传输加载 Internet 内容所需的资产，包括 HTML 页面、javascript 文件、样式表(例如CSS)、图像和视频。CDN 服务越来越受欢迎，如今大部分网络流量都通过 CDN 提供服务，包括来自 Facebook、Netflix 和亚马逊等主要网站的流量。

内容分发网络和边缘计算本质上是试图让冰箱和行李箱之间的距离尽可能近。通过将数据复制到更靠近需要的地方，可以显著减少延迟。



##  误区三：带宽是无穷大的

![img](https://architecturenotes.co/content/images/2022/06/8-lessons-v2-separate-01.jpg)

